#!/usr/bin/env bash
# Installing haproxy server - latest version

# update and ugrade server if needed
apt-get -y update
apt-get -y upgrade

# Install latest haproxy
apt-get -y install haproxy

# haproxy configurations
configurations="\
frontend balancer
    bind *:80
    mode http
    default_backend servers

backend servers
    balance roundrobin
    server web-01 34.207.190.83:80 check
    server web-02 52.91.178.39:80 check
"

# Add the configurations to .cfg
echo "$configurations" >> /etc/haproxy/haproxy.cfg

sudo service haproxy start
